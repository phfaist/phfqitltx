
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{phfquotetext}[2016/02/20 phfquotetext package]


% ------------------------------------------------------------------------------
% quoting environment useful e.g. to quote email text. Like a verbatim
% environment (i.e. with no macro expansion), but with no whitespace
% preformatting.
% ------------------------------------------------------------------------------

%\tracingall


%
% Allows to set custom catcodes for parsing of quotetext contents.
%
% By default, all char catcodes are set as "other" characters, but you may
% redefine this macro to define you own catcodes.
%
\newcommand\quotetextcatcodedefs{%
  % no defs by default
}

%
% Definitions which are called
%
\newcommand\quotetextstart{%
  % nothing by default
}
\newcommand\quotetextend{%
  % nothing by default
}

%
% Set up the font and display for the quote text environment.
%
% This command may also be defined to take one single argument, which will be
% the whole contents of the quotetext environment.  For example:
%
%\newcommand\quotetextfont[1]{%
%  \sout{#1}%
%}
%
\newcommand\quotetextfont{\ttfamily}




%
% internal: read an argument delimited until ....\end{quotetext}, end group, and
% call the start/show/end commands.
%
\begingroup
  \catcode`|=0
  \catcode`\<=1
  \catcode`\>=2
  \catcode`\{=12
  \catcode`\}=12
  \catcode`\\=12
  |long|gdef|docnote@quotetext@warg@#1\end{quotetext}<|endgroup|quotetextstart|docnote@quotetext@show<#1>|quotetextend>
|endgroup




\newtoks\qtt@mytoks
\long\def\docnote@quotetext@show#1{%
  \qtt@mytoks={#1}%
  \begingroup%
  \edef\qtt@cmdarg{{\the\qtt@mytoks}}% \the\toks only expands once and prohibits further expansion, remember.
  \expandafter\quotetextfont\qtt@cmdarg
  % \quotetextfont{%
  %   \the\qtt@mytoks%
  % }%
  \endgroup%
  \end{quotetext}%
}
\def\docnote@quotetext@warg{%
  %
  \let\do\@makeother%
  \dospecials% verbatim catcodes -- \dospecials comes from LaTeX itself
  \catcode`\ =10% exceptions
  \relax%
  \quotetextcatcodedefs%
  \docnote@quotetext@warg@%
}

\newenvironment{quotetext}{%
  %
  % Enclose the full quote text stuff into its own group to make definitions local.
  % 
  \begingroup%
  % 
  \docnote@quotetext@warg%
}{}

% --------------------------------------------------


